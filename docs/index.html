---

title: SMART on FHIR python client demo


keywords: fastai
sidebar: home_sidebar

summary: "Demo the python SMART on FHIR client."
description: "Demo the python SMART on FHIR client."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://colab.research.google.com/github/pete88b/smart-on-fhir-client-py-demo/blob/main/index.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<p>Using <a href="https://github.com/smart-on-fhir/client-py">client-py</a>, this project aims to provide some simple demos to help people get started with the python client.</p>
<p>This is also a learning excercise - so if you see anything that could be done better, please let us know.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Getting-started">Getting started<a class="anchor-link" href="#Getting-started"> </a></h2><p>Note: This project <code>pip install</code>s <a href="https://github.com/smart-on-fhir/">the latest client-py code</a>. We could install <a href="https://github.com/smart-on-fhir/client-py/commit/6047277daa31f10931e44ed19e92128298cdb64b">this commit</a> if breaking changes are introduced.</p>
<p>We're using the latest client-py code becuase <a href="https://pypi.org/project/fhirclient/#history">PyPI history</a> shows the last available release was <code>3.2.0</code> 2018-02-06 ... and we want to use some of the new FHIR R4 features.</p>
<h3 id="If-you-want-to-run-everything-on-your-own-machine">If you want to run everything on your own machine<a class="anchor-link" href="#If-you-want-to-run-everything-on-your-own-machine"> </a></h3><h4 id="Clone-this-project-and-set-up-a-conda-environment">Clone this project and set-up a conda environment<a class="anchor-link" href="#Clone-this-project-and-set-up-a-conda-environment"> </a></h4>
<pre><code>git clone https://github.com/pete88b/smart-on-fhir-client-py-demo.git
cd smart-on-fhir-client-py-demo
conda create -n smart-on-fhir-client-py-demo python==3.8 -y
conda activate smart-on-fhir-client-py-demo
pip install -r requirements.txt
nbdev_install_git_hooks</code></pre>
<h4 id="Start-jupyter">Start jupyter<a class="anchor-link" href="#Start-jupyter"> </a></h4><p>If you have already created and activated your conda environment, you can start a notebook server with;</p>

<pre><code>jupyter notebook</code></pre>
<h3 id="If-you-want-to-run-demo-notebooks-using-google-colab">If you want to run demo notebooks using google colab<a class="anchor-link" href="#If-you-want-to-run-demo-notebooks-using-google-colab"> </a></h3><ul>
<li>Open <a href="https://colab.research.google.com/github/pete88b/smart-on-fhir-client-py-demo/blob/main/index.ipynb">this notebook</a> in colab</li>
<li>Open <a href="https://colab.research.google.com/github/pete88b/smart-on-fhir-client-py-demo/blob/main/_flask_hello_world_colab.ipynb">_flask_hello_world_colab.ipynb</a> in colab</li>
<li>Open <a href="https://colab.research.google.com/github/pete88b/smart-on-fhir-client-py-demo/blob/main/51_flask_client_py_readme.ipynb">51_flask_client_py_readme.ipynb</a> in colab</li>
</ul>
<p>The cell below will install the fhirclient if you're running in colab.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-print_resource---a-generic-way-to-print-a-resource">Define <a href="/smart-on-fhir-client-py-demo/core.html#print_resource"><code>print_resource</code></a> - a generic way to print a resource<a class="anchor-link" href="#Define-print_resource---a-generic-way-to-print-a-resource"> </a></h2><p>We use <code>print_resource(procedure)</code> etc, rather than looking at specific resource details with code like <code>procedure.code.coding[0].as_json()</code>, so that the demos won't fail if resouces are missing specific content.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">print_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">s</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">as_json</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">length</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; ...&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span><span class="n">length</span> <span class="k">else</span> <span class="n">s</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Client-use">Client use<a class="anchor-link" href="#Client-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets start by trying to make something like the code examples in <a href="https://github.com/smart-on-fhir/client-py">client-py README.md</a> work.</p>
<p>These docs refer to the FHIR server <a href="https://fhir-open-api-dstu2.smarthealthit.org">https://fhir-open-api-dstu2.smarthealthit.org</a> which is probably not running any more.</p>
<p>The following demos will use <a href="http://wildfhir4.aegis.net/fhir4-0-0">http://wildfhir4.aegis.net/fhir4-0-0</a> - which is one of the "open" servers listed on the <a href="https://confluence.hl7.org/display/FHIR/Public+Test+Servers">public test servers wiki</a>. If you'd like to try other servers, feel free to change <code>api_base</code> &darr;</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;app_id&#39;</span><span class="p">:</span> <span class="s1">&#39;my_web_app&#39;</span><span class="p">,</span>
    <span class="s1">&#39;api_base&#39;</span><span class="p">:</span> <span class="s1">&#39;http://wildfhir4.aegis.net/fhir4-0-0&#39;</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-Data-from-Server">Read Data from Server<a class="anchor-link" href="#Read-Data-from-Server"> </a></h3><p>Note: We use <code>Resource ID</code> <code>'f001'</code> rather than <code>'hca-pat-1'</code> - which could be found with a <a href="http://wildfhir4.aegis.net/fhir4-0-0-gui/index.jsf">Aegis FHIR4-0-0 GUI</a> search.</p>
<p>If the <code>p.Patient.read</code> call raises <code>FHIRNotFoundException: &lt;Response [404]&gt;</code>, it probably means that the <code>Resource ID</code> does not exist on the server.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fhirclient</span> <span class="kn">import</span> <span class="n">client</span>
<span class="n">smart</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">FHIRClient</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">fhirclient.models.patient</span> <span class="k">as</span> <span class="nn">p</span>
<span class="n">patient</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Patient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;f001&#39;</span><span class="p">,</span> <span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Birth Date&#39;</span><span class="p">,</span> <span class="n">patient</span><span class="o">.</span><span class="n">birthDate</span><span class="o">.</span><span class="n">isostring</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Patient Name&#39;</span><span class="p">,</span> <span class="n">smart</span><span class="o">.</span><span class="n">human_name</span><span class="p">(</span><span class="n">patient</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Birth Date 1994-11-17
Patient Name Pieter van de Heuvel, MSc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note: We could show the full patient resource as JSON with <code>patient.as_json()</code> - which should give us the same data as <code>GET</code> <a href="http://wildfhir4.aegis.net/fhir4-0-0/Patient/f001">http://wildfhir4.aegis.net/fhir4-0-0/Patient/f001</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="If-this-is-a-protected-server-...">If this is a protected server ...<a class="anchor-link" href="#If-this-is-a-protected-server-..."> </a></h2><p>I'm going to ignore authorization for now as <code>smart.authorize_url</code> and <code>smart.prepare()</code> raise exceptions with most of the FHIR servers I've tried.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="You-can-work-with-the-FHIRServer-class-directly,-without-using-FHIRClient,-but-this-is-not-recommended">You can work with the <code>FHIRServer</code> class directly, without using <code>FHIRClient</code>, but this is not recommended<a class="anchor-link" href="#You-can-work-with-the-FHIRServer-class-directly,-without-using-FHIRClient,-but-this-is-not-recommended"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fhirclient</span> <span class="kn">import</span> <span class="n">server</span>
<span class="n">smart</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">FHIRServer</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;api_base&#39;</span><span class="p">])</span>
<span class="kn">import</span> <span class="nn">fhirclient.models.patient</span> <span class="k">as</span> <span class="nn">p</span>
<span class="n">patient</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Patient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;f001&#39;</span><span class="p">,</span> <span class="n">smart</span><span class="p">)</span>
<span class="n">patient</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">given</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Pieter&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Search-Records-on-Server">Search Records on Server<a class="anchor-link" href="#Search-Records-on-Server"> </a></h2><p>Note: I think <code>GET</code> <a href="http://wildfhir4.aegis.net/fhir4-0-0/Patient/f001/Procedure">http://wildfhir4.aegis.net/fhir4-0-0/Patient/f001/Procedure</a> should work</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">smart</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">FHIRClient</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">fhirclient.models.procedure</span> <span class="k">as</span> <span class="nn">p</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Procedure</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">struct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="s1">&#39;f001&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">})</span>
<span class="n">procedures</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">perform_resources</span><span class="p">(</span><span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
<span class="k">for</span> <span class="n">procedure</span> <span class="ow">in</span> <span class="n">procedures</span><span class="p">:</span>
    <span class="n">print_resource</span><span class="p">(</span><span class="n">procedure</span><span class="p">)</span>
<span class="c1">#     print(procedure.id, procedure.code.coding[0].as_json())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#34;id&#34;: &#34;f001&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:31.947-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
{&#34;id&#34;: &#34;f002&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.153-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
{&#34;id&#34;: &#34;f003&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.574-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
{&#34;id&#34;: &#34;f004&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.868-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="To-include-the-resources-referred-to-by-the-procedure-via-subject-in-the-results">To include the resources referred to by the procedure via <code>subject</code> in the results<a class="anchor-link" href="#To-include-the-resources-referred-to-by-the-procedure-via-subject-in-the-results"> </a></h3><p>Before calling <code>search.include('subject')</code>, <code>search.construct()</code> gave us</p>
<ul>
<li><code>Procedure?subject=f001&amp;status=completed</code></li>
</ul>
<p>After calling <code>search.include('subject')</code>, <code>search.construct()</code> gave us</p>
<ul>
<li><code>Procedure?subject=f001&amp;status=completed&amp;_include=Procedure:subject</code></li>
</ul>
<p>so ... <code>search.perform_resources</code> will now give us a list of procedures <em>and patients</em> that the procedures refer to.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">procedures</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">perform_resources</span><span class="p">(</span><span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
<span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">procedures</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">print_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Procedure
{&#34;id&#34;: &#34;f001&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:31.947-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Patient
{&#34;id&#34;: &#34;f001&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2021-02-01T14:47:43.050-05:00&#34;, &#34;versionId&#34;: &#34;5&#34;}, &#34;text ...
Procedure
{&#34;id&#34;: &#34;f002&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.153-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Procedure
{&#34;id&#34;: &#34;f003&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.574-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Procedure
{&#34;id&#34;: &#34;f004&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.868-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we could check the type of resource and run specific code for each type with something like</p>

<pre><code>for resource in procedures:
    if isinstance(resource, p.Procedure):
        # process Procedure here
        print(resource.id, resource.code.coding[0].as_json())
    else:
        # process Patient here
        print('Patient', resource.id)</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="To-include-the-MedicationAdministration-resources-which-refer-to-the-procedure-via-partOf">To include the MedicationAdministration resources which refer to the procedure via <code>partOf</code><a class="anchor-link" href="#To-include-the-MedicationAdministration-resources-which-refer-to-the-procedure-via-partOf"> </a></h3><p>We probably won't find any <code>MedicationAdministration</code>s ...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fhirclient.models.medicationadministration</span> <span class="k">as</span> <span class="nn">m</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;partOf&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">MedicationAdministration</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">procedures</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">perform_resources</span><span class="p">(</span><span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
<span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">procedures</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">print_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Procedure
{&#34;id&#34;: &#34;f001&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:31.947-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Patient
{&#34;id&#34;: &#34;f001&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2021-02-01T14:47:43.050-05:00&#34;, &#34;versionId&#34;: &#34;5&#34;}, &#34;text ...
Procedure
{&#34;id&#34;: &#34;f002&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.153-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Procedure
{&#34;id&#34;: &#34;f003&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.574-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
Procedure
{&#34;id&#34;: &#34;f004&#34;, &#34;meta&#34;: {&#34;lastUpdated&#34;: &#34;2020-11-15T19:51:32.868-05:00&#34;, &#34;security&#34;: [{&#34;code&#34;: &#34;H ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>to get the raw Bundle instead of resources only, you can use:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bundle</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
<span class="c1"># we&#39;ll just show the 1st 200 characters of the bundle (after converting to JSON)</span>
<span class="n">print_resource</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  &#34;id&#34;: &#34;5d16c5f5-8fa0-4d4a-8510-b592d17d833e&#34;,
  &#34;meta&#34;: {
    &#34;lastUpdated&#34;: &#34;2021-04-29T09:40:02.182-04:00&#34;,
    &#34;versionId&#34;: &#34;1&#34;
  },
  &#34;entry&#34;: [
    {
      &#34;fullUrl&#34;: &#34;http://wildfhir4.ae ...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Model-Use">Data Model Use<a class="anchor-link" href="#Data-Model-Use"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fhirclient.models.patient</span> <span class="k">as</span> <span class="nn">p</span>
<span class="kn">import</span> <span class="nn">fhirclient.models.humanname</span> <span class="k">as</span> <span class="nn">hn</span>
<span class="n">patient</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Patient</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;patient-1&#39;</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">patient</span><span class="o">.</span><span class="n">as_json</span><span class="p">())</span> <span class="c1"># prints `patient-1`</span>

<span class="n">name</span> <span class="o">=</span> <span class="n">hn</span><span class="o">.</span><span class="n">HumanName</span><span class="p">()</span>
<span class="n">name</span><span class="o">.</span><span class="n">given</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Peter&#39;</span><span class="p">]</span>
<span class="n">name</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="s1">&#39;Parker&#39;</span>
<span class="n">patient</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">patient</span><span class="o">.</span><span class="n">as_json</span><span class="p">())</span> <span class="c1"># prints patient&#39;s JSON representation, now with id and name</span>

<span class="n">name</span><span class="o">.</span><span class="n">given</span> <span class="o">=</span> <span class="s1">&#39;Peter&#39;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">patient</span><span class="o">.</span><span class="n">as_json</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;patient.as_json() raised&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span><span class="s1">&#39;with message&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;id&#39;: &#39;patient-1&#39;, &#39;resourceType&#39;: &#39;Patient&#39;}
{&#39;id&#39;: &#39;patient-1&#39;, &#39;name&#39;: [{&#39;family&#39;: &#39;Parker&#39;, &#39;given&#39;: [&#39;Peter&#39;]}], &#39;resourceType&#39;: &#39;Patient&#39;}
patient.as_json() raised &lt;class &#39;fhirclient.models.fhirabstractbase.FHIRValidationError&#39;&gt; with message
{root}:
  name.0:
    given:
      Expecting property &#34;given&#34; on &lt;class &#39;fhirclient.models.humanname.HumanName&#39;&gt; to be list, but is &lt;class &#39;str&#39;&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Initialize-from-JSON-file">Initialize from JSON file<a class="anchor-link" href="#Initialize-from-JSON-file"> </a></h2><p>Create a folder to save json data to</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">data_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create a file by reading a patient from the server and writing as json</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fhirclient.models.patient</span> <span class="k">as</span> <span class="nn">p</span>

<span class="n">smart</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">FHIRClient</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
<span class="n">patient</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Patient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;f001&#39;</span><span class="p">,</span> <span class="n">smart</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;patient.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">patient</span><span class="o">.</span><span class="n">as_json</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can read the json file and initialize a <code>Patient</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;patient.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
    <span class="n">pjs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="n">patient</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">Patient</span><span class="p">(</span><span class="n">pjs</span><span class="p">)</span>
<span class="n">patient</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">given</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Pieter&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-the-flask-app">Run the flask app<a class="anchor-link" href="#Run-the-flask-app"> </a></h2><p>51_flask_client_py_readme.ipynb creates a Flask app like <a href="https://github.com/smart-on-fhir/client-py/blob/master/flask_app.py">the client-py demo flask app</a>.</p>
<p>You can run <code>python smart_on_fhir_client_py_demo/flask_client_py_readme.py</code> from the command line and hit</p>
<ul>
<li><a href="http://localhost:8000/">http://localhost:8000/</a></li>
</ul>
<p>This is a little different to the client-py demo;</p>
<ul>
<li>It's set-up to run against <a href="http://wildfhir4.aegis.net/fhir4-0-0">http://wildfhir4.aegis.net/fhir4-0-0</a> which is a no-auth server</li>
<li>It'll allow you to select a patient if you're running against a no-auth server<ul>
<li><a href="http://localhost:8000/logout">http://localhost:8000/logout</a></li>
</ul>
</li>
<li>It'll allow you to pass a patient ID as a URL paramter<ul>
<li><a href="http://localhost:8000/?patient_id=patient456">http://localhost:8000/?patient_id=patient456</a></li>
</ul>
</li>
<li>Note: It hasn't been tested with an auth server yet.</li>
</ul>

</div>
</div>
</div>
</div>
 

